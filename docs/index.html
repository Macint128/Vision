<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>손 따라 부드럽게 움직이는 아이콘</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      overflow: hidden;
    }

    video {
      display: none;
    }

    #icon {
      position: absolute;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      color: white;
      z-index: 10;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }
  </style>
</head>
<body>

<video id="input_video" autoplay playsinline muted></video>
<div id="icon">📦</div>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
  const video = document.getElementById('input_video');
  const icon = document.getElementById('icon');

  let targetX = window.innerWidth / 2;
  let targetY = window.innerHeight / 2;
  let currentX = targetX;
  let currentY = targetY;
  let handVisible = false;

  function animate() {
    // 부드럽게 따라가기 (lerp)
    currentX += (targetX - currentX) * 0.15;
    currentY += (targetY - currentY) * 0.15;
    icon.style.left = `${currentX - 40}px`;
    icon.style.top = `${currentY - 40}px`;

    icon.style.opacity = handVisible ? 1 : 0;
    requestAnimationFrame(animate);
  }
  animate();

  const hands = new Hands({
    locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
  });

  hands.setOptions({
    maxNumHands: 1,
    modelComplexity: 1,
    minDetectionConfidence: 0.7,
    minTrackingConfidence: 0.7
  });

  hands.onResults((results) => {
    if (!results.multiHandLandmarks || results.multiHandLandmarks.length === 0) {
      handVisible = false;
      return;
    }

    const indexFinger = results.multiHandLandmarks[0][8];
    const vw = video.videoWidth;
    const vh = video.videoHeight;

    const x = indexFinger.x * vw;
    const y = indexFinger.y * vh;

    // 화면 비율에 맞게 조정 (iOS Safari 대응)
    const rect = video.getBoundingClientRect();
    targetX = rect.left + (x / vw) * rect.width;
    targetY = rect.top + (y / vh) * rect.height;
    handVisible = true;
  });

  const camera = new Camera(video, {
    onFrame: async () => {
      await hands.send({ image: video });
    },
    width: 1280,
    height: 720,
    facingMode: { ideal: "environment" } // iOS Safari 대응
  });

  camera.start();
</script>

</body>
</html>
