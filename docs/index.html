<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VisionOS Ïä§ÌÉÄÏùº MR Ïï± - MediaPipe ÌïÄÏπò Í∞êÏßÄ</title>
    <!-- MediaPipe Ìï∏Ï¶à ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎìú -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mediapipe-hands/0.4.1675466547/hands.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            user-select: none;
        }
        
        body {
            background-color: #000;
            color: #fff;
            min-height: 100vh;
            overflow: hidden;
        }
        
        .camera-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 0;
            overflow: hidden;
        }
        
        #camera-view {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.2;
        }
        
        #hand-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }
        
        .eye-tracking {
            position: fixed;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(100, 180, 255, 0.6);
            box-shadow: 0 0 15px rgba(100, 180, 255, 0.8);
            pointer-events: none;
            z-index: 9999;
            transition: transform 0.1s ease;
            display: none;
        }
        
        .gesture-indicator {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.6);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 9999;
        }
        
        .pinch-indicator {
            position: fixed;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 2px solid rgba(100, 180, 255, 0.6);
            box-shadow: 0 0 15px rgba(100, 180, 255, 0.5);
            pointer-events: none;
            z-index: 10000;
            display: none;
            transition: transform 0.2s ease, opacity 0.2s ease;
        }
        
        .pinch-progress {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid rgba(100, 180, 255, 0.9);
            transform: scale(0);
            transform-origin: center;
            transition: transform 0.3s ease;
        }
        
        .apps-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 20px;
            padding: 40px 20px;
            z-index: 2;
        }
        
        .app-icon {
            position: relative;
            background: rgba(60, 90, 150, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .app-icon.focused {
            background: rgba(100, 150, 255, 0.25);
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(100, 180, 255, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .app-icon-image {
            width: 60%;
            height: 60%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            margin-bottom: 10px;
        }
        
        .app-icon-name {
            font-size: 12px;
            text-align: center;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .app-window {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 80vw;
            height: 70vh;
            background: linear-gradient(135deg, rgba(60, 90, 150, 0.2), rgba(30, 50, 100, 0.2));
            backdrop-filter: blur(15px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3),
                        0 0 20px rgba(100, 180, 255, 0.2);
            display: flex;
            flex-direction: column;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .app-window.visible {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }
        
        .window-header {
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .window-title {
            font-size: 18px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .window-close {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(255, 100, 100, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 1px solid rgba(255, 100, 100, 0.4);
        }
        
        .window-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .window-footer {
            padding: 10px 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            height: 40px;
        }
        
        .footer-handle {
            width: 60px;
            height: 5px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }
        
        .background-scene {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 10%, rgba(100, 180, 255, 0.2), transparent 60%);
            z-index: 1;
            pointer-events: none;
        }
        
        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .particle {
            position: absolute;
            width: 5px;
            height: 5px;
            background-color: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(100, 180, 255, 0.8);
            animation: float 20s infinite linear;
        }
        
        .hand-cursor {
            position: fixed;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(100, 255, 150, 0.4);
            border: 2px solid rgba(100, 255, 150, 0.8);
            box-shadow: 0 0 15px rgba(100, 255, 150, 0.5);
            pointer-events: none;
            z-index: 9999;
            display: none;
            transform-origin: center;
        }
        
        .camera-switch {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(60, 90, 150, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            z-index: 9999;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(100, 180, 255, 0.4);
        }
        
        @keyframes float {
            0% {
                transform: translate(0, 0) scale(0.8);
                opacity: 0;
            }
            20% {
                opacity: 0.5;
            }
            80% {
                opacity: 0.5;
            }
            100% {
                transform: translate(var(--end-x), var(--end-y)) scale(0.2);
                opacity: 0;
            }
        }
        
        .debug-panel {
            position: fixed;
            bottom: 80px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 10px;
            font-size: 12px;
            z-index: 9999;
            max-width: 300px;
        }
    </style>
</head>
<body>
    <div class="background-scene"></div>
    <div class="floating-particles" id="particles"></div>
    
    <div class="camera-container">
        <video id="camera-view" autoplay playsinline muted></video>
        <canvas id="hand-canvas"></canvas>
    </div>
    
    <button class="camera-switch" id="camera-switch">üîÑ</button>
    
    <div class="eye-tracking" id="eye-cursor"></div>
    <div class="hand-cursor" id="hand-cursor"></div>
    <div class="gesture-indicator" id="gesture-text">Ïπ¥Î©îÎùº Ï†ëÍ∑º Ï§ë...</div>
    <div class="pinch-indicator" id="pinch-indicator">
        <div class="pinch-progress" id="pinch-progress"></div>
    </div>
    
    <div class="debug-panel" id="debug-panel">
        <div>ÏÜê Í∞êÏßÄ: Ï§ÄÎπÑ Ï§ë...</div>
        <div>Ï†úÏä§Ï≤ò: ÏóÜÏùå</div>
    </div>
    
    <div class="apps-container" id="apps-grid">
        <div class="app-icon" data-app="messages">
            <div class="app-icon-image">üí¨</div>
            <div class="app-icon-name">Î©îÏãúÏßÄ</div>
        </div>
        <div class="app-icon" data-app="photos">
            <div class="app-icon-image">üñºÔ∏è</div>
            <div class="app-icon-name">ÏÇ¨ÏßÑ</div>
        </div>
        <div class="app-icon" data-app="safari">
            <div class="app-icon-image">üåê</div>
            <div class="app-icon-name">ÏÇ¨ÌååÎ¶¨</div>
        </div>
        <div class="app-icon" data-app="maps">
            <div class="app-icon-image">üó∫Ô∏è</div>
            <div class="app-icon-name">ÏßÄÎèÑ</div>
        </div>
        <div class="app-icon" data-app="music">
            <div class="app-icon-image">üéµ</div>
            <div class="app-icon-name">ÏùåÏïÖ</div>
        </div>
        <div class="app-icon" data-app="calendar">
            <div class="app-icon-image">üìÖ</div>
            <div class="app-icon-name">Ï∫òÎ¶∞Îçî</div>
        </div>
        <div class="app-icon" data-app="notes">
            <div class="app-icon-image">üìù</div>
            <div class="app-icon-name">Î©îÎ™®</div>
        </div>
        <div class="app-icon" data-app="weather">
            <div class="app-icon-image">‚òÄÔ∏è</div>
            <div class="app-icon-name">ÎÇ†Ïî®</div>
        </div>
        <div class="app-icon" data-app="settings">
            <div class="app-icon-image">‚öôÔ∏è</div>
            <div class="app-icon-name">ÏÑ§Ï†ï</div>
        </div>
    </div>
    
    <div class="app-window" id="app-window">
        <div class="window-header">
            <div class="window-title" id="window-title">Ïï± Ïù¥Î¶Ñ</div>
            <div class="window-close" id="window-close">‚úï</div>
        </div>
        <div class="window-content" id="window-content">
            <p>Ïï± ÏΩòÌÖêÏ∏†Í∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§.</p>
        </div>
        <div class="window-footer">
            <div class="footer-handle" id="window-handle"></div>
        </div>
    </div>

    <script>
        // DOM ÏöîÏÜå
        const cameraView = document.getElementById('camera-view');
        const handCanvas = document.getElementById('hand-canvas');
        const cameraSwitch = document.getElementById('camera-switch');
        const handCursor = document.getElementById('hand-cursor');
        const gestureText = document.getElementById('gesture-text');
        const pinchIndicator = document.getElementById('pinch-indicator');
        const pinchProgress = document.getElementById('pinch-progress');
        const appIcons = document.querySelectorAll('.app-icon');
        const appWindow = document.getElementById('app-window');
        const windowTitle = document.getElementById('window-title');
        const windowContent = document.getElementById('window-content');
        const windowClose = document.getElementById('window-close');
        const windowHandle = document.getElementById('window-handle');
        const debugPanel = document.getElementById('debug-panel');
        
        // ÏÉÅÌÉú Î≥ÄÏàò
        let isWindowDragging = false;
        let dragStartX = 0;
        let dragStartY = 0;
        let windowStartX = 0;
        let windowStartY = 0;
        let focusedAppIcon = null;
        let pinchStartTime = null;
        let handTrackingActive = false;
        let usingFrontCamera = false;
        let isPinching = false;
        let pinchHoldStartTime = null;
        let lastPinchState = false;
        let indexFingerTip = { x: 0, y: 0 };
        let thumbTip = { x: 0, y: 0 };
        let canvasCtx = null;
        let hands = null;
        let videoWidth = 0;
        let videoHeight = 0;
        
        // Î∞∞Í≤Ω ÏûÖÏûê ÏÉùÏÑ±
        const particlesContainer = document.getElementById('particles');
        const particleCount = 30;
        
        for (let i = 0; i < particleCount; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            
            // ÎûúÎç§Ìïú ÏãúÏûë ÏúÑÏπò
            const startX = Math.random() * 100;
            const startY = Math.random() * 100;
            
            // ÎûúÎç§Ìïú ÎÅù ÏúÑÏπò
            const endX = (Math.random() - 0.5) * 200;
            const endY = (Math.random() - 0.5) * 200;
            
            // ÌÅ¨Í∏∞ Î≥ÄÍ≤Ω
            const size = Math.random() * 4 + 2;
            
            // Ïï†ÎãàÎ©îÏù¥ÏÖò ÏßÄÏó∞
            const delay = Math.random() * 20;
            
            // Ïï†ÎãàÎ©îÏù¥ÏÖò ÏÜçÎèÑ
            const duration = Math.random() * 20 + 10;
            
            particle.style.width = `${size}px`;
            particle.style.height = `${size}px`;
            particle.style.left = `${startX}%`;
            particle.style.top = `${startY}%`;
            particle.style.setProperty('--end-x', `${endX}px`);
            particle.style.setProperty('--end-y', `${endY}px`);
            particle.style.animationDuration = `${duration}s`;
            particle.style.animationDelay = `${delay}s`;
            
            particlesContainer.appendChild(particle);
        }
        
        // MediaPipe Ï¥àÍ∏∞Ìôî
        async function initMediaPipe() {
            try {
                hands = new Hands({
                    locateFile: (file) => {
                        return `https://cdnjs.cloudflare.com/ajax/libs/mediapipe-hands/0.4.1675466547/${file}`;
                    }
                });
                
                hands.setOptions({
                    maxNumHands: 1,
                    modelComplexity: 1,
                    minDetectionConfidence: 0.5,
                    minTrackingConfidence: 0.5
                });
                
                hands.onResults(onHandResults);
                
                showMessage('Ìï∏Îìú Ìä∏ÎûòÌÇπ Î™®Îìà Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
                
                // Ïπ¥Î©îÎùº Ï†ëÍ∑º
                await initCamera();
                
            } catch (error) {
                console.error('MediaPipe Ï¥àÍ∏∞Ìôî Ïò§Î•ò:', error);
                showMessage('MediaPipe Ï¥àÍ∏∞Ìôî Ïã§Ìå®, Í∏∞Î≥∏ Ïù∏ÌÑ∞ÎûôÏÖòÏúºÎ°ú Ï†ÑÌôòÌï©ÎãàÎã§');
                // ÎåÄÏ≤¥ ÏÉÅÌò∏ÏûëÏö© ÌôúÏÑ±Ìôî
                simulateWithMouse();
            }
        }
        
        // Ïπ¥Î©îÎùº Ï†ëÍ∑º
        async function initCamera() {
            try {
                // ÌõÑÎ©¥ Ïπ¥Î©îÎùº ÏÇ¨Ïö© (environment)
                const constraints = {
                    video: { facingMode: usingFrontCamera ? 'user' : 'environment' }
                };
                
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                cameraView.srcObject = stream;
                
                cameraView.onloadedmetadata = () => {
                    videoWidth = cameraView.videoWidth;
                    videoHeight = cameraView.videoHeight;
                    
                    // Ï∫îÎ≤ÑÏä§ Ï¥àÍ∏∞Ìôî
                    handCanvas.width = videoWidth;
                    handCanvas.height = videoHeight;
                    canvasCtx = handCanvas.getContext('2d');
                    
                    // ÏÜê Ï∂îÏ†Å ÏãúÏûë
                    handTrackingActive = true;
                    startMediaPipeHandTracking();
                    
                    showMessage(usingFrontCamera ? 'Ï†ÑÎ©¥ Ïπ¥Î©îÎùº ÌôúÏÑ±Ìôî' : 'ÌõÑÎ©¥ Ïπ¥Î©îÎùº ÌôúÏÑ±Ìôî');
                };
            } catch (error) {
                console.error('Ïπ¥Î©îÎùº Ï†ëÍ∑º Ïò§Î•ò:', error);
                showMessage('Ïπ¥Î©îÎùº Ï†ëÍ∑º Ïã§Ìå®, Î∏åÎùºÏö∞Ï†Ä Í∂åÌïúÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî');
                simulateWithMouse();
            }
        }
        
        // Ïπ¥Î©îÎùº Ï†ÑÌôò (Ï†ÑÎ©¥/ÌõÑÎ©¥)
        cameraSwitch.addEventListener('click', async () => {
            // ÌòÑÏû¨ Ïä§Ìä∏Î¶º Ï§ëÏßÄ
            if (cameraView.srcObject) {
                cameraView.srcObject.getTracks().forEach(track => track.stop());
            }
            
            // Ïπ¥Î©îÎùº Î™®Îìú Ï†ÑÌôò
            usingFrontCamera = !usingFrontCamera;
            
            // ÏÉà Ïπ¥Î©îÎùºÎ°ú Îã§Ïãú ÏãúÏûë
            await initCamera();
        });
        
        // MediaPipe Ìï∏Îìú Ìä∏ÎûòÌÇπ ÏãúÏûë
        async function startMediaPipeHandTracking() {
            if (!handTrackingActive) return;
            
            try {
                await hands.send({ image: cameraView });
            } catch (error) {
                console.error('Hand tracking error:', error);
            }
            
            // ÌîÑÎ†àÏûÑÎßàÎã§ Ïã§Ìñâ
            if (handTrackingActive) {
                requestAnimationFrame(startMediaPipeHandTracking);
            }
        }
        
        // MediaPipe Í≤∞Í≥º Ï≤òÎ¶¨
        function onHandResults(results) {
            canvasCtx.save();
            canvasCtx.clearRect(0, 0, handCanvas.width, handCanvas.height);
            
            // Í≤∞Í≥ºÍ∞Ä ÏûàÏúºÎ©¥ Ï≤òÎ¶¨
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const landmarks = results.multiHandLandmarks[0];
                
                // Í≤ÄÏßÄ ÏÜêÍ∞ÄÎùΩ ÎÅùÍ≥º ÏóÑÏßÄ ÏÜêÍ∞ÄÎùΩ ÎÅù Ï∂îÏ∂ú
                indexFingerTip = {
                    x: landmarks[8].x * window.innerWidth,
                    y: landmarks[8].y * window.innerHeight
                };
                
                thumbTip = {
                    x: landmarks[4].x * window.innerWidth,
                    y: landmarks[4].y * window.innerHeight
                };
                
                // ÌïÄÏπò Ï†úÏä§Ï≤ò Í∞êÏßÄ
                const distance = calculateDistance(indexFingerTip, thumbTip);
                const isPinchNow = distance < 30; // 30px Ïù¥ÌïòÎ°ú Í∞ÄÍπåÏö∞Î©¥ ÌïÄÏπòÎ°ú Ïù∏Ïãù
                
                // ÏÜê Ïª§ÏÑú ÌëúÏãú
                handCursor.style.display = 'block';
                handCursor.style.transform = `translate(${indexFingerTip.x - 15}px, ${indexFingerTip.y - 15}px)`;
                
                // ÌïÄÏπò ÏÉÅÌÉúÍ∞Ä ÏãúÏûëÎêòÏóàÏùÑ Îïå
                if (isPinchNow && !lastPinchState) {
                    onPinchStart();
                }
                // ÌïÄÏπò Ï§ëÏùº Îïå
                else if (isPinchNow && lastPinchState) {
                    onPinchHold();
                }
                // ÌïÄÏπòÍ∞Ä ÎÅùÎÇ¨ÏùÑ Îïå
                else if (!isPinchNow && lastPinchState) {
                    onPinchEnd();
                }
                
                lastPinchState = isPinchNow;
                
                // ÏÜêÍ∞ÄÎùΩÏúºÎ°ú Ìè¨Ïù∏ÌåÖ Ï§ëÏù∏ Ïï± ÏïÑÏù¥ÏΩò ÌôïÏù∏
                checkFocus(indexFingerTip.x, indexFingerTip.y);
                
                // ÎîîÎ≤ÑÍ∑∏ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
                updateDebugInfo(distance, isPinchNow);
                
                // ÏÜê ÎûúÎìúÎßàÌÅ¨ Í∑∏Î¶¨Í∏∞ (ÎîîÎ≤ÑÍ∑∏Ïö©)
                drawHandLandmarks(landmarks);
            } else {
                // ÏÜêÏù¥ Í∞êÏßÄÎêòÏßÄ ÏïäÏùÑ Îïå
                handCursor.style.display = 'none';
                
                // ÌïÄÏπò ÏÉÅÌÉúÏóêÏÑú ÏÜêÏù¥ ÏÇ¨ÎùºÏßÑ Í≤ΩÏö∞ ÌïÄÏπò Ï¢ÖÎ£å
                if (lastPinchState) {
                    onPinchEnd();
                    lastPinchState = false;
                }
                
                // ÎîîÎ≤ÑÍ∑∏ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
                debugPanel.innerHTML = `
                    <div>ÏÜê Í∞êÏßÄ: ÏóÜÏùå</div>
                    <div>Ï†úÏä§Ï≤ò: ÏóÜÏùå</div>
                `;
            }
            
            canvasCtx.restore();
        }
        
        // Îëê Ï†ê ÏÇ¨Ïù¥Ïùò Í±∞Î¶¨ Í≥ÑÏÇ∞
        function calculateDistance(point1, point2) {
            return Math.sqrt(
                Math.pow(point2.x - point1.x, 2) + 
                Math.pow(point2.y - point1.y, 2)
            );
        }
        
        // ÌïÄÏπò ÏãúÏûë Ï≤òÎ¶¨
        function onPinchStart() {
            pinchHoldStartTime = Date.now();
            isPinching = true;
            
            // ÌòÑÏû¨ ÏúàÎèÑÏö∞Í∞Ä Ïó¥Î†§ÏûàÍ≥† Ï∞Ω ÌïòÎã®ÏùÑ ÌïÄÏπòÌïòÎäî Ï§ëÏù¥ÎùºÎ©¥ ÎìúÎûòÍ∑∏ ÏãúÏûë
            if (appWindow.classList.contains('visible')) {
                const windowRect = appWindow.getBoundingClientRect();
                const footerRect = windowHandle.getBoundingClientRect();
                
                if (
                    indexFingerTip.x >= footerRect.left &&
                    indexFingerTip.x <= footerRect.right &&
                    indexFingerTip.y >= footerRect.top &&
                    indexFingerTip.y <= footerRect.bottom
                ) {
                    startWindowDrag({
                        preventDefault: () => {},
                        type: 'pinch',
                        clientX: indexFingerTip.x,
                        clientY: indexFingerTip.y
                    });
                }
                return;
            }
            
            // Ïï± ÏïÑÏù¥ÏΩòÏóê Ìè¨Ïª§Ïä§ÎêòÏñ¥ ÏûàÏùÑ ÎïåÎßå ÌïÄÏπò Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ ÌëúÏãú
            if (focusedAppIcon) {
                pinchIndicator.style.display = 'block';
                pinchIndicator.style.transform = `translate(${indexFingerTip.x - 40}px, ${indexFingerTip.y - 40}px)`;
                
                // ÌïÄÏπò Ïï†ÎãàÎ©îÏù¥ÏÖò ÏãúÏûë
                pinchProgress.style.transform = 'scale(0)';
                pinchStartTime = Date.now();
            }
        }
        
        // ÌïÄÏπò Ïú†ÏßÄ Ï≤òÎ¶¨
        function onPinchHold() {
            if (!isPinching) return;
            
            // ÏúàÎèÑÏö∞ ÎìúÎûòÍ∑∏ Ï§ëÏù¥Î©¥ Í≥ÑÏÜç Ïù¥Îèô
            if (isWindowDragging) {
                moveWindow({
                    type: 'pinch',
                    clientX: indexFingerTip.x,
                    clientY: indexFingerTip.y
                });
                return;
            }
            
            // Ïï± ÏïÑÏù¥ÏΩò ÌïÄÏπò Ï§ëÏù¥Î©¥ ÏßÑÌñâ ÌëúÏãú
            if (focusedAppIcon && pinchStartTime) {
                const elapsed = Date.now() - pinchStartTime;
                const progress = Math.min(elapsed / 1000, 1); // 1Ï¥à ÎèôÏïà ÏôÑÎ£å
                
                pinchProgress.style.transform = `scale(${progress})`;
                
                // ÌïÄÏπò ÏôÑÎ£å Ïãú Ïï± Ïã§Ìñâ
                if (progress >= 1) {
                    completePinch();
                    pinchStartTime = null;
                }
            }
        }
        
        // ÌïÄÏπò Ï¢ÖÎ£å Ï≤òÎ¶¨
        function onPinchEnd() {
            isPinching = false;
            pinchIndicator.style.display = 'none';
            pinchProgress.style.transform = 'scale(0)';
            
            // ÏúàÎèÑÏö∞ ÎìúÎûòÍ∑∏ Ï§ëÏù¥ÏóàÎã§Î©¥ Ï§ëÏßÄ
            if (isWindowDragging) {
                stopWindowDrag();
            }
        }
        
        // ÌïÄÏπò ÏôÑÎ£åÏãú Ïï± Ïã§Ìñâ
        function completePinch() {
            if (!focusedAppIcon) {
                pinchIndicator.style.display = 'none';
                return;
            }
            
            const appName = focusedAppIcon.getAttribute('data-app');
            openApp(appName);
            
            pinchIndicator.style.display = 'none';
            showMessage(`${appName} Ïï±ÏùÑ Ïã§ÌñâÌï©ÎãàÎã§`);
        }
        
        // MediaPipe ÏÜê ÎûúÎìúÎßàÌÅ¨ Í∑∏Î¶¨Í∏∞ (ÎîîÎ≤ÑÍ∑∏Ïö©)
        function drawHandLandmarks(landmarks) {
            canvasCtx.fillStyle = 'rgba(100, 255, 150, 0.5)';
            canvasCtx.strokeStyle = 'rgba(100, 255, 150, 0.8)';
            canvasCtx.lineWidth = 2;
            
            // ÏÜêÍ∞ÄÎùΩ Ïó∞Í≤∞ Í∑∏Î¶¨Í∏∞
            const connections = [
                [0, 1], [1, 2], [2, 3], [3, 4], // ÏóÑÏßÄ
                [0, 5], [5, 6], [6, 7], [7, 8], // Í≤ÄÏßÄ
                [0, 9], [9, 10], [10, 11], [11, 12], // Ï§ëÏßÄ
                [0, 13], [13, 14], [14, 15], [15, 16], // ÏïΩÏßÄ
                [0, 17], [17, 18], [18, 19], [19, 20] // ÏÜåÏßÄ
            ];
            
            // Ïó∞Í≤∞ÏÑ† Í∑∏Î¶¨Í∏∞
            for (const [i, j] of connections) {
                const from = landmarks[i];
                const to = landmarks[j];
                
                canvasCtx.beginPath();
                canvasCtx.moveTo(from.x * handCanvas.width, from.y * handCanvas.height);
                canvasCtx.lineTo(to.x * handCanvas.width, to.y * handCanvas.height);
                canvasCtx.stroke();
            }
            
            // ÎûúÎìúÎßàÌÅ¨ Ï†ê Í∑∏Î¶¨Í∏∞
            for (const landmark of landmarks) {
                canvasCtx.beginPath();
                canvasCtx.arc(
                    landmark.x * handCanvas.width,
                    landmark.y * handCanvas.height,
                    5
