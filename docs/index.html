<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VisionSim OS</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: black;
      font-family: -apple-system, sans-serif;
    }

    video#camera {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      z-index: 0;
      transform: scaleX(-1); /* Ï¢åÏö∞ Î∞òÏ†Ñ */
    }

    canvas#overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 1;
      pointer-events: none;
    }

    .icon {
      position: absolute;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      backdrop-filter: blur(8px);
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      font-weight: bold;
      font-size: 1.5rem;
      z-index: 2;
      transition: transform 0.2s, background 0.2s;
    }

    .icon.hovered {
      background: rgba(255,255,255,0.5);
      transform: scale(1.2);
    }
  </style>
</head>
<body>

  <video id="camera" autoplay playsinline muted></video>
  <canvas id="overlay"></canvas>

  <!-- Ïï± ÏïÑÏù¥ÏΩò -->
  <div id="icon1" class="icon" style="top: 30%; left: 40%;">üì∏</div>
  <div id="icon2" class="icon" style="top: 30%; left: 60%;">üåê</div>

  <!-- MediaPipe -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>

  <script>
    const videoElement = document.getElementById('camera');
    const canvasElement = document.getElementById('overlay');
    const canvasCtx = canvasElement.getContext('2d');

    const icons = [
      document.getElementById('icon1'),
      document.getElementById('icon2')
    ];

    function getIconCenter(icon) {
      const rect = icon.getBoundingClientRect();
      return {
        x: rect.left + rect.width / 2,
        y: rect.top + rect.height / 2
      };
    }

    function checkHover(landmark, icon) {
      const handX = landmark.x * window.innerWidth;
      const handY = landmark.y * window.innerHeight;
      const {x, y} = getIconCenter(icon);
      const dx = handX - x;
      const dy = handY - y;
      return Math.sqrt(dx * dx + dy * dy) < 50;
    }

    const hands = new Hands({
      locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
    });

    hands.setOptions({
      maxNumHands: 1,
      modelComplexity: 1,
      minDetectionConfidence: 0.7,
      minTrackingConfidence: 0.7
    });

    hands.onResults(results => {
      canvasCtx.save();
      canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);

      if (results.multiHandLandmarks.length > 0) {
        const landmarks = results.multiHandLandmarks[0];

        drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS, {color: '#00FF00', lineWidth: 2});
        drawLandmarks(canvasCtx, landmarks, {color: '#00FF00', lineWidth: 1});

        // ÏóÑÏßÄÏôÄ Í≤ÄÏßÄ Í±∞Î¶¨
        const pinchDist = Math.hypot(
          landmarks[4].x - landmarks[8].x,
          landmarks[4].y - landmarks[8].y
        );

        icons.forEach(icon => {
          const isHover = checkHover(landmarks[8], icon);
          icon.classList.toggle("hovered", isHover);
          if (isHover && pinchDist < 0.03) {
            icon.style.transform = "scale(1.5)";
          }
        });
      }

      canvasCtx.restore();
    });

    const camera = new Camera(videoElement, {
      onFrame: async () => {
        await hands.send({image: videoElement});
      },
      width: 1280,
      height: 720
    });
    camera.start();

    // Resize canvas
    window.addEventListener('resize', () => {
      canvasElement.width = window.innerWidth;
      canvasElement.height = window.innerHeight;
    });
    canvasElement.width = window.innerWidth;
    canvasElement.height = window.innerHeight;
  </script>
</body>
</html>
